<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.8.26">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Raman Challenge Dataset Analysis – Nicolas’ Notebook</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = '/';
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-75c24fa0c77a874b0ab0aff8b6422dd8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     <script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>  <script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>  
        <link rel="stylesheet" href="../../../styles.css">
      </head>

  <body class="floating nav-fixed quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link"><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Raman Challenge Dataset Analysis</h6>

            <a href="../../../posts/raman/notebooks/_eda.ipynb" class="btn btn-primary quarto-download-embed" download="_eda.ipynb">Download Notebook</a>
          </div>

     <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Nicolas’ Notebook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nbrosse"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/nicolas-brosse-984685a0/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=sQ6d5AYAAAAJ&amp;hl"> <i class="bi bi-google" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.researchgate.net/profile/Nicolas-Brosse-3"> <i class="bi bi-r-circle" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Raman Challenge Dataset Analysis</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link active" data-scroll-target="#dataset-description">Dataset Description</a></li>
  <li><a href="#data-structure-overview" id="toc-data-structure-overview" class="nav-link" data-scroll-target="#data-structure-overview">Data Structure Overview</a></li>
  <li><a href="#step-by-step-preprocessing-visualization" id="toc-step-by-step-preprocessing-visualization" class="nav-link" data-scroll-target="#step-by-step-preprocessing-visualization">Step-by-Step Preprocessing Visualization</a></li>
  <li><a href="#understanding-spectral-cropping" id="toc-understanding-spectral-cropping" class="nav-link" data-scroll-target="#understanding-spectral-cropping">Understanding Spectral Cropping</a></li>
  <li><a href="#sample-structure-and-organization" id="toc-sample-structure-and-organization" class="nav-link" data-scroll-target="#sample-structure-and-organization">Sample Structure and Organization</a></li>
  <li><a href="#exploring-concentration-distribution" id="toc-exploring-concentration-distribution" class="nav-link" data-scroll-target="#exploring-concentration-distribution">Exploring Concentration Distribution</a></li>
  <li><a href="#assigning-sample-numbers" id="toc-assigning-sample-numbers" class="nav-link" data-scroll-target="#assigning-sample-numbers">Assigning Sample Numbers</a></li>
  <li><a href="#comparing-preprocessing-pipelines-standard-vs.-background-subtraction" id="toc-comparing-preprocessing-pipelines-standard-vs.-background-subtraction" class="nav-link" data-scroll-target="#comparing-preprocessing-pipelines-standard-vs.-background-subtraction">Comparing Preprocessing Pipelines: Standard vs.&nbsp;Background Subtraction</a></li>
  <li><a href="#comparing-pipelines-on-different-concentrations" id="toc-comparing-pipelines-on-different-concentrations" class="nav-link" data-scroll-target="#comparing-pipelines-on-different-concentrations">Comparing Pipelines on Different Concentrations</a></li>
  <li><a href="#comparing-pipelines-on-replicate-spectra" id="toc-comparing-pipelines-on-replicate-spectra" class="nav-link" data-scroll-target="#comparing-pipelines-on-replicate-spectra">Comparing Pipelines on Replicate Spectra</a></li>
  <li><a href="#understanding-measurement-variability" id="toc-understanding-measurement-variability" class="nav-link" data-scroll-target="#understanding-measurement-variability">Understanding Measurement Variability</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">      
     <div id="50a6ff66" class="cell markdown">
<p>This notebook analyzes the dig-4-bio-raman transfer learning challenge dataset and demonstrates how to load and work with the multi-instrument Raman spectroscopy data.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="c666486d9737ba2c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;ExecuteTime&quot;,&quot;value&quot;:{&quot;end_time&quot;:&quot;2025-06-30T09:12:39.062386Z&quot;,&quot;start_time&quot;:&quot;2025-06-30T09:12:38.236205Z&quot;}}" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ramanspy <span class="im">as</span> rp</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">SyntaxWarning</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div id="ad3cdf34675b32de" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;ExecuteTime&quot;,&quot;value&quot;:{&quot;end_time&quot;:&quot;2025-06-30T09:12:39.507927Z&quot;,&quot;start_time&quot;:&quot;2025-06-30T09:12:39.504163Z&quot;}}" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">Define common paths and preprocessing pipelines.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">This section sets up:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">- Data directory path</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">- Standard preprocessing pipeline (without normalization)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - Cropping to fingerprint region (300-1942 cm⁻¹)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Cosmic ray removal (Whitaker-Hayes)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - Denoising (Savitzky-Golay filter)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - Baseline correction (ASPLS)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">Note: Normalization is commented out as it can destroy concentration information</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">for regression tasks.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Data directory path</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> Path(<span class="st">"../data/dig-4-bio-raman-transfer-learning-challenge"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Fingerprint region</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>MIN_WAVENUMBER <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>MAX_WAVENUMBER <span class="op">=</span> <span class="dv">1942</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard preprocessing pipeline without normalization</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># This pipeline is suitable for regression tasks where we want to preserve</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># concentration-related intensity information</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>standard_pipeline_without_normalisation <span class="op">=</span> rp.preprocessing.Pipeline([</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    rp.preprocessing.misc.Cropper(region<span class="op">=</span>(MIN_WAVENUMBER, MAX_WAVENUMBER)),  <span class="co"># Fingerprint region</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    rp.preprocessing.despike.WhitakerHayes(),          <span class="co"># Remove cosmic rays</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    rp.preprocessing.denoise.SavGol(window_length<span class="op">=</span><span class="dv">9</span>, polyorder<span class="op">=</span><span class="dv">3</span>),  <span class="co"># Smooth noise</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    rp.preprocessing.baseline.ASPLS(),                 <span class="co"># Remove baseline drift</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rp.preprocessing.normalise.MinMax()  # Excluded for regression tasks</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div id="7b4a7266" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">Utility functions</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_spectral_columns(df: pd.DataFrame) <span class="op">-&gt;</span> <span class="bu">tuple</span>[<span class="bu">list</span>[<span class="bu">str</span>], <span class="bu">list</span>[<span class="bu">str</span>], np.ndarray]:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Identifies spectral data columns by checking if the column name can be converted to a float.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    This is a robust way to separate metadata from spectral data.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    spectral_cols <span class="op">=</span> []</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    metadata_cols <span class="op">=</span> []</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">float</span>(col)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            spectral_cols.append(col)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">ValueError</span>, <span class="pp">TypeError</span>):</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            metadata_cols.append(col)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    wavenumbers <span class="op">=</span> pd.to_numeric(spectral_cols)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> metadata_cols, spectral_cols, wavenumbers</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_background_subtraction_pipeline(background: rp.Spectrum) <span class="op">-&gt;</span> rp.preprocessing.Pipeline:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Builds a background subtraction pipeline with a specified region for cropping.</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    background <span class="op">=</span> rp.preprocessing.misc.Cropper(region<span class="op">=</span>(MIN_WAVENUMBER, MAX_WAVENUMBER)).<span class="bu">apply</span>(background)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rp.preprocessing.Pipeline([</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        rp.preprocessing.misc.Cropper(region<span class="op">=</span>(MIN_WAVENUMBER, MAX_WAVENUMBER)),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        rp.preprocessing.misc.BackgroundSubtractor(background<span class="op">=</span>background)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    ])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div id="f4d74c50" class="cell markdown">
<section id="dataset-description" class="level3">
<h3 class="anchored" data-anchor-id="dataset-description">Dataset Description</h3>
<p>This dataset contains Raman spectra from <strong>8 different instruments</strong> measuring samples with known concentrations of three analytes:</p>
<ul>
<li><strong>Glucose</strong> (g/L)</li>
<li><strong>Sodium Acetate</strong> (Na_acetate, g/L)</li>
<li><strong>Magnesium Sulfate</strong> (Mg_SO4, g/L)</li>
</ul>
<p>The instruments included are: Anton 532, Anton 785, Kaiser, Metrohm, Mettler Toledo, Tec 5, Timegate, and Tornado.</p>
<p><strong>Measurement Protocol:</strong></p>
<ul>
<li>All samples were measured at room temperature with instrument-specific exposure times</li>
<li>Most instruments acquired 5 replicate spectra per sample; Kaiser and Timegate recorded a single spectrum per sample</li>
<li>Due to varying instrument availability, the sample sets differ across spectrometers</li>
</ul>
<p><strong>Instrument Characteristics:</strong> Each instrument exhibits unique properties that must be accounted for in analysis:</p>
<ul>
<li><strong>Wavenumber ranges</strong>: Vary from ~200 to ~3500 cm⁻¹ across instruments</li>
<li><strong>Spectral resolution</strong>: Differs between instruments</li>
</ul>
<p>Let’s start by loading data from one instrument (anton_532) to understand the data structure and visualize a sample spectrum.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [20]:</pre></div><div id="4b2c8fb8" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">Load and visualize a sample spectrum from the anton_532 instrument.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">This demonstrates:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">1. Loading CSV data with spectral columns (wavenumbers) and metadata</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">2. Separating spectral data from metadata</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">3. Creating a RamanSPy SpectralContainer for analysis</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">4. Visualizing a raw spectrum with its concentration information</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data from anton_532 instrument</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(data_path <span class="op">/</span> <span class="st">"anton_532.csv"</span>).drop(columns<span class="op">=</span>[<span class="st">"MSM_present"</span>, <span class="st">"fold_idx"</span>])</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate spectral columns (numeric column names = wavenumbers) from metadata</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>metadata_cols, spectral_cols, wavenumbers <span class="op">=</span> find_spectral_columns(df)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create RamanSPy SpectralContainer for easier manipulation</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>spectral_container <span class="op">=</span> rp.SpectralContainer(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    spectral_data<span class="op">=</span>df[spectral_cols].values,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    spectral_axis<span class="op">=</span>wavenumbers</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Select first spectrum for visualization</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>spectrum <span class="op">=</span> spectral_container[<span class="dv">0</span>]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> df[metadata_cols].iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create informative title with concentration information</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> (</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Original Spectrum - "</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"glucose </span><span class="sc">{</span>metadata[<span class="st">'glucose'</span>]<span class="sc">:.4f}</span><span class="ss"> g/L - "</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Na_acetate </span><span class="sc">{</span>metadata[<span class="st">'Na_acetate'</span>]<span class="sc">:.4f}</span><span class="ss"> g/L - "</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Mg_SO4 </span><span class="sc">{</span>metadata[<span class="st">'Mg_SO4'</span>]<span class="sc">:.4f}</span><span class="ss"> g/L"</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the spectrum</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>rp.plot.spectra(spectra<span class="op">=</span>[spectrum], plot_type<span class="op">=</span><span class="st">"single"</span>, title<span class="op">=</span>title)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>rp.plot.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="_eda_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="c016d764" class="cell markdown">
<section id="data-structure-overview" class="level3">
<h3 class="anchored" data-anchor-id="data-structure-overview">Data Structure Overview</h3>
<p>Let’s examine the structure of the loaded dataset to understand how the data is organized. The DataFrame contains:</p>
<ul>
<li><strong>Metadata columns</strong>: Concentration values (glucose, Na_acetate, Mg_SO4) and other sample information</li>
<li><strong>Spectral columns</strong>: Numeric column names representing wavenumber values (cm⁻¹)</li>
<li>Each row represents a single spectrum measurement with its associated concentration metadata</li>
</ul>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div id="4c6e1511" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">200.0</th>
<th data-quarto-table-cell-role="th">202.0</th>
<th data-quarto-table-cell-role="th">204.0</th>
<th data-quarto-table-cell-role="th">206.0</th>
<th data-quarto-table-cell-role="th">208.0</th>
<th data-quarto-table-cell-role="th">210.0</th>
<th data-quarto-table-cell-role="th">212.0</th>
<th data-quarto-table-cell-role="th">214.0</th>
<th data-quarto-table-cell-role="th">216.0</th>
<th data-quarto-table-cell-role="th">218.0</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">3488.0</th>
<th data-quarto-table-cell-role="th">3490.0</th>
<th data-quarto-table-cell-role="th">3492.0</th>
<th data-quarto-table-cell-role="th">3494.0</th>
<th data-quarto-table-cell-role="th">3496.0</th>
<th data-quarto-table-cell-role="th">3498.0</th>
<th data-quarto-table-cell-role="th">3500.0</th>
<th data-quarto-table-cell-role="th">glucose</th>
<th data-quarto-table-cell-role="th">Na_acetate</th>
<th data-quarto-table-cell-role="th">Mg_SO4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>7519.06</td>
<td>7582.15</td>
<td>7379.73</td>
<td>7054.04</td>
<td>6818.64</td>
<td>6684.24</td>
<td>6562.20</td>
<td>6398.03</td>
<td>6256.17</td>
<td>6135.72</td>
<td>...</td>
<td>6539.65</td>
<td>6475.20</td>
<td>6573.45</td>
<td>6488.44</td>
<td>6284.99</td>
<td>6216.51</td>
<td>6409.21</td>
<td>0.26335</td>
<td>1.4357</td>
<td>1.44101</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>7414.24</td>
<td>7502.98</td>
<td>7327.93</td>
<td>7002.97</td>
<td>6760.01</td>
<td>6638.17</td>
<td>6539.84</td>
<td>6360.47</td>
<td>6200.67</td>
<td>6080.42</td>
<td>...</td>
<td>6507.23</td>
<td>6451.34</td>
<td>6564.97</td>
<td>6465.79</td>
<td>6241.37</td>
<td>6171.89</td>
<td>6358.46</td>
<td>0.26335</td>
<td>1.4357</td>
<td>1.44101</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>7376.45</td>
<td>7474.90</td>
<td>7304.00</td>
<td>6961.46</td>
<td>6691.31</td>
<td>6557.30</td>
<td>6470.64</td>
<td>6309.66</td>
<td>6177.40</td>
<td>6090.05</td>
<td>...</td>
<td>6501.41</td>
<td>6432.22</td>
<td>6521.16</td>
<td>6452.89</td>
<td>6248.68</td>
<td>6137.06</td>
<td>6318.74</td>
<td>0.26335</td>
<td>1.4357</td>
<td>1.44101</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>7383.60</td>
<td>7456.90</td>
<td>7264.59</td>
<td>6938.71</td>
<td>6707.66</td>
<td>6594.61</td>
<td>6493.20</td>
<td>6307.50</td>
<td>6144.74</td>
<td>6033.89</td>
<td>...</td>
<td>6498.85</td>
<td>6412.12</td>
<td>6532.58</td>
<td>6459.36</td>
<td>6240.35</td>
<td>6146.15</td>
<td>6325.52</td>
<td>0.26335</td>
<td>1.4357</td>
<td>1.44101</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>7345.77</td>
<td>7435.40</td>
<td>7263.58</td>
<td>6929.82</td>
<td>6671.51</td>
<td>6544.19</td>
<td>6459.28</td>
<td>6302.71</td>
<td>6158.40</td>
<td>6043.02</td>
<td>...</td>
<td>6506.29</td>
<td>6414.26</td>
<td>6530.51</td>
<td>6435.62</td>
<td>6214.08</td>
<td>6156.26</td>
<td>6348.95</td>
<td>0.26335</td>
<td>1.4357</td>
<td>1.44101</td>
</tr>
</tbody>
</table>

<p>5 rows × 1654 columns</p>
</div>
</div>
</div></div>
<div id="5a08945a" class="cell markdown">
<section id="step-by-step-preprocessing-visualization" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-preprocessing-visualization">Step-by-Step Preprocessing Visualization</h3>
<p>Preprocessing is crucial for Raman spectroscopy data analysis. Raw spectra contain:</p>
<ul>
<li><strong>Baseline drift</strong>: Broad fluorescence background</li>
<li><strong>Cosmic rays</strong>: Sharp spikes from detector artifacts</li>
<li><strong>Noise</strong>: Random measurement noise</li>
<li><strong>Edge effects</strong>: Instrument-specific artifacts at spectral edges</li>
</ul>
<p>This section visualizes how each preprocessing step transforms the spectrum, helping us understand the impact of each operation. We apply the following steps:</p>
<ul>
<li><strong>Cropping</strong>: Remove edge artifacts and focus on fingerprint region (300-1942 cm⁻¹)</li>
<li><strong>Cosmic Ray Removal</strong>: Remove sharp spikes (Whitaker-Hayes algorithm)</li>
<li><strong>Denoising</strong>: Smooth the spectrum (Savitzky-Golay filter)</li>
<li><strong>Baseline Correction</strong>: Remove broad fluorescence background (ASPLS)</li>
</ul>
<p>This visualization helps understand how each preprocessing step improves signal quality and prepares the data for analysis.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div id="5d170e6f" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(data_path <span class="op">/</span> <span class="st">"anton_532.csv"</span>).drop( columns<span class="op">=</span>[<span class="st">"MSM_present"</span>, <span class="st">"fold_idx"</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>metadata_cols, spectral_cols, wavenumbers <span class="op">=</span> find_spectral_columns(df)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spectral_container <span class="op">=</span> rp.SpectralContainer(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    spectral_data<span class="op">=</span>df[spectral_cols].values,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    spectral_axis<span class="op">=</span>wavenumbers</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>spectrum <span class="op">=</span> spectral_container[<span class="dv">0</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> df[metadata_cols].iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="ss">f"Original Spectrum - glucose </span><span class="sc">{</span>metadata[<span class="st">'glucose'</span>]<span class="sc">:.4f}</span><span class="ss"> gL - Na_acetate </span><span class="sc">{</span>metadata[<span class="st">'Na_acetate'</span>]<span class="sc">:.4f}</span><span class="ss"> gL - Mg_SO4 </span><span class="sc">{</span>metadata[<span class="st">'Mg_SO4'</span>]<span class="sc">:.4f}</span><span class="ss"> gL"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>rp.plot.spectra(spectra<span class="op">=</span>[spectrum], plot_type<span class="op">=</span><span class="st">"single"</span>, title<span class="op">=</span>title)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>rp.plot.show()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> standard_pipeline_without_normalisation:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    spectrum <span class="op">=</span> step.<span class="bu">apply</span>(spectrum)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>step<span class="sc">.</span><span class="va">__class__</span><span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    rp.plot.spectra([spectrum], plot_type<span class="op">=</span><span class="st">"single"</span>, title<span class="op">=</span>title)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    rp.plot.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_eda_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_eda_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_eda_files/figure-html/cell-7-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_eda_files/figure-html/cell-7-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_eda_files/figure-html/cell-7-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="907d2292" class="cell markdown">
<section id="understanding-spectral-cropping" class="level3">
<h3 class="anchored" data-anchor-id="understanding-spectral-cropping">Understanding Spectral Cropping</h3>
<p>From the visualization above, we can observe:</p>
<ul>
<li><strong>Wavenumber range</strong>: Approximately 300–3600 cm⁻¹</li>
<li><strong>Strong baseline/fluorescence</strong>: Broad curvature from background fluorescence</li>
<li><strong>Edge artifacts</strong>:
<ul>
<li>Below ~450 cm⁻¹: Edge effects, Rayleigh tail, optical artifacts</li>
<li>Above ~3000 cm⁻¹: OH stretch from water dominates the signal</li>
</ul></li>
<li><strong>Chemically informative region</strong>: The fingerprint region (400–1800 cm⁻¹) contains the most relevant information</li>
</ul>
<p>The reference paper <a href="https://doi.org/10.1016/j.saa.2025.125861">Comparing machine learning methods on Raman spectra from eight different spectrometers</a> recommends:</p>
<ul>
<li><strong>Crop to 300–1942 cm⁻¹</strong>: The largest common range across all 8 instruments</li>
<li><strong>Rationale</strong>:
<ul>
<li>Preserves glucose, acetate, and MgSO₄ peaks</li>
<li>Removes high-wavenumber water OH stretch</li>
<li>Eliminates instrument-specific edge artifacts</li>
<li>Improves cross-device robustness for transfer learning</li>
</ul></li>
</ul>
<p>For this dataset, cropping to <strong>300–1942 cm⁻¹</strong> is justified because:</p>
<ul>
<li><strong>Glucose peaks</strong>: ~800–1150 cm⁻¹ ✓</li>
<li><strong>Acetate peak</strong>: ~920 cm⁻¹ ✓</li>
<li><strong>MgSO₄ strong peak</strong>: ~980 cm⁻¹ ✓</li>
<li><strong>Minimal water interference</strong>: Removes dominant OH stretch region</li>
<li><strong>Better signal-to-noise</strong>: Focuses on chemically informative region</li>
</ul>
<p>This region contains the most relevant information for quantitative analysis while removing noise and artifacts.</p>
</section>
</div>
<div id="e7df0f30" class="cell markdown">
<section id="sample-structure-and-organization" class="level3">
<h3 class="anchored" data-anchor-id="sample-structure-and-organization">Sample Structure and Organization</h3>
<p>The dataset is organized around <strong>unique concentration triplets</strong> defined by the three analytes:</p>
<ul>
<li><strong>Glucose</strong> (g/L)</li>
<li><strong>Sodium Acetate</strong> (Na_acetate, g/L)</li>
<li><strong>Magnesium Sulfate</strong> (Mg_SO4, g/L)</li>
</ul>
<p><strong>Replication Structure:</strong></p>
<ul>
<li>Most instruments (Anton 532, Anton 785, Metrohm, Mettler Toledo, Tec 5, Tornado) recorded <strong>at least 5 replicate spectra</strong> per unique concentration triplet</li>
<li><strong>Kaiser and Timegate instruments</strong> recorded only <strong>1 spectrum per concentration triplet</strong> (no replicates)</li>
</ul>
<p><strong>Sample Numbering:</strong> To facilitate analysis and visualization, we assign a unique <code>sample_number</code> to each distinct concentration triplet. This allows us to:</p>
<ul>
<li>Group spectra by their concentration profile</li>
<li>Select representative spectra from each unique sample</li>
<li>Track how preprocessing affects spectra from the same sample across different replicates</li>
</ul>
</section>
</div>
<div id="c4ae9ddd" class="cell markdown">
<section id="exploring-concentration-distribution" class="level3">
<h3 class="anchored" data-anchor-id="exploring-concentration-distribution">Exploring Concentration Distribution</h3>
<p>Let’s examine the distribution of unique concentration triplets in the dataset. This helps us understand:</p>
<ul>
<li>How many unique samples (concentration combinations) are present</li>
<li>The frequency of each concentration triplet</li>
<li>The overall structure of the experimental design</li>
</ul>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div id="81048a91" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_metadata <span class="op">=</span> df[metadata_cols]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_metadata[[<span class="st">"glucose"</span>, <span class="st">"Na_acetate"</span>, <span class="st">"Mg_SO4"</span>]].value_counts()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>glucose   Na_acetate  Mg_SO4  
0.00000   0.00000     0.000000    10
                      0.022899     5
                      1.483750     5
                      3.490220     5
          0.01612     0.005016     5
          0.38593     0.023827     5
          0.65286     0.046091     5
          0.71544     1.567450     5
          0.75931     0.017697     5
          0.76773     3.945410     5
          1.29106     0.000000     5
          1.37442     1.355800     5
          1.39750     3.308900     5
0.24955   0.08245     3.454390     5
0.25369   0.00000     0.022609     5
0.25636   0.67294     0.005511     5
0.25649   0.74089     3.345560     5
0.25787   0.00000     0.000000     5
0.26229   0.03709     1.494600     5
0.26335   1.43570     1.441010     5
0.27710   0.69733     1.441180     5
0.28256   1.33788     0.035751     5
0.29784   1.56128     3.348590     5
0.49945   1.33009     0.003688     5
0.51645   1.02701     1.328620     5
0.52096   0.00000     0.015037     5
0.52616   0.00000     1.396560     5
0.53269   0.68172     0.056479     5
0.56078   1.07925     3.139890     5
0.79631   1.06674     3.090570     5
1.02342   0.71756     1.557450     5
1.18537   0.00000     2.948570     5
4.56573   0.69828     1.541520     5
4.62097   0.97254     0.014210     5
4.63261   0.69969     0.022235     5
4.73407   0.67310     0.003497     5
4.77883   0.00000     0.023272     5
4.78962   1.03913     1.497530     5
4.87666   0.72635     3.073870     5
4.91288   1.03532     3.302040     5
5.12832   0.02430     1.715070     5
5.24672   0.02440     3.361270     5
6.39311   0.00000     0.024451     5
10.16120  0.00000     1.477840     5
10.28120  0.66554     0.000000     5
10.35390  0.00000     0.000000     5
10.39640  0.68902     1.602520     5
10.59310  1.11418     3.484130     5
10.65220  0.00000     2.620210     5
10.66050  1.13599     1.624690     5
10.71080  0.74408     3.480790     5
10.74480  1.05836     0.005669     5
16.73440  0.00000     0.022216     5
Name: count, dtype: int64</code></pre>
</div>
</div></div>
<div id="3deb13b5" class="cell markdown">
<section id="assigning-sample-numbers" class="level3">
<h3 class="anchored" data-anchor-id="assigning-sample-numbers">Assigning Sample Numbers</h3>
<p>To facilitate analysis, we assign a unique <code>sample_number</code> to each distinct concentration triplet. This allows us to:</p>
<ul>
<li>Group all replicate spectra from the same sample together</li>
<li>Easily select representative spectra for visualization</li>
<li>Track samples across different preprocessing steps</li>
</ul>
<p>After assignment, we sort the DataFrame by <code>sample_number</code> to organize the data for easier analysis.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div id="54a306a6" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sample_number'</span>] <span class="op">=</span> df.groupby([<span class="st">'glucose'</span>, <span class="st">'Na_acetate'</span>, <span class="st">'Mg_SO4'</span>]).ngroup()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div id="2861004b" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(by<span class="op">=</span><span class="st">"sample_number"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">200.0</th>
<th data-quarto-table-cell-role="th">202.0</th>
<th data-quarto-table-cell-role="th">204.0</th>
<th data-quarto-table-cell-role="th">206.0</th>
<th data-quarto-table-cell-role="th">208.0</th>
<th data-quarto-table-cell-role="th">210.0</th>
<th data-quarto-table-cell-role="th">212.0</th>
<th data-quarto-table-cell-role="th">214.0</th>
<th data-quarto-table-cell-role="th">216.0</th>
<th data-quarto-table-cell-role="th">218.0</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">3490.0</th>
<th data-quarto-table-cell-role="th">3492.0</th>
<th data-quarto-table-cell-role="th">3494.0</th>
<th data-quarto-table-cell-role="th">3496.0</th>
<th data-quarto-table-cell-role="th">3498.0</th>
<th data-quarto-table-cell-role="th">3500.0</th>
<th data-quarto-table-cell-role="th">glucose</th>
<th data-quarto-table-cell-role="th">Na_acetate</th>
<th data-quarto-table-cell-role="th">Mg_SO4</th>
<th data-quarto-table-cell-role="th">sample_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>7872.51</td>
<td>7949.13</td>
<td>7756.47</td>
<td>7430.07</td>
<td>7191.07</td>
<td>7054.33</td>
<td>6923.01</td>
<td>6728.96</td>
<td>6566.42</td>
<td>6446.71</td>
<td>...</td>
<td>8358.85</td>
<td>8459.03</td>
<td>8365.43</td>
<td>8120.00</td>
<td>7994.58</td>
<td>8164.45</td>
<td>0.0000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>7855.57</td>
<td>7937.75</td>
<td>7754.15</td>
<td>7431.91</td>
<td>7196.21</td>
<td>7069.05</td>
<td>6947.50</td>
<td>6745.40</td>
<td>6582.47</td>
<td>6474.62</td>
<td>...</td>
<td>8294.69</td>
<td>8415.91</td>
<td>8343.10</td>
<td>8109.79</td>
<td>7992.89</td>
<td>8171.26</td>
<td>0.0000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>7880.69</td>
<td>7968.58</td>
<td>7784.68</td>
<td>7442.57</td>
<td>7186.43</td>
<td>7063.44</td>
<td>6968.17</td>
<td>6777.16</td>
<td>6612.35</td>
<td>6503.68</td>
<td>...</td>
<td>8341.36</td>
<td>8440.34</td>
<td>8340.85</td>
<td>8101.21</td>
<td>7993.53</td>
<td>8176.15</td>
<td>0.0000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>7816.74</td>
<td>7903.64</td>
<td>7718.65</td>
<td>7384.09</td>
<td>7142.29</td>
<td>7031.14</td>
<td>6940.11</td>
<td>6749.42</td>
<td>6575.63</td>
<td>6450.89</td>
<td>...</td>
<td>8321.98</td>
<td>8416.93</td>
<td>8310.16</td>
<td>8071.10</td>
<td>7973.64</td>
<td>8140.15</td>
<td>0.0000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">45</th>
<td>7927.66</td>
<td>8014.66</td>
<td>7817.07</td>
<td>7476.43</td>
<td>7234.11</td>
<td>7111.39</td>
<td>6999.47</td>
<td>6808.78</td>
<td>6644.33</td>
<td>6525.25</td>
<td>...</td>
<td>8359.07</td>
<td>8461.60</td>
<td>8376.35</td>
<td>8146.79</td>
<td>8041.58</td>
<td>8224.00</td>
<td>0.0000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">197</th>
<td>8207.04</td>
<td>8318.43</td>
<td>8149.32</td>
<td>7811.73</td>
<td>7548.74</td>
<td>7407.86</td>
<td>7296.73</td>
<td>7115.31</td>
<td>6970.95</td>
<td>6873.25</td>
<td>...</td>
<td>9045.37</td>
<td>9158.60</td>
<td>9078.45</td>
<td>8841.36</td>
<td>8711.15</td>
<td>8854.53</td>
<td>16.7344</td>
<td>0.0</td>
<td>0.022216</td>
<td>52</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">196</th>
<td>8297.09</td>
<td>8374.05</td>
<td>8181.89</td>
<td>7849.53</td>
<td>7608.91</td>
<td>7486.01</td>
<td>7376.52</td>
<td>7186.54</td>
<td>7024.39</td>
<td>6912.22</td>
<td>...</td>
<td>9154.26</td>
<td>9271.12</td>
<td>9179.31</td>
<td>8934.16</td>
<td>8822.59</td>
<td>8995.83</td>
<td>16.7344</td>
<td>0.0</td>
<td>0.022216</td>
<td>52</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">195</th>
<td>8478.47</td>
<td>8586.03</td>
<td>8417.81</td>
<td>8090.71</td>
<td>7841.44</td>
<td>7706.42</td>
<td>7591.60</td>
<td>7406.22</td>
<td>7241.26</td>
<td>7116.70</td>
<td>...</td>
<td>9541.84</td>
<td>9634.93</td>
<td>9526.42</td>
<td>9289.84</td>
<td>9193.64</td>
<td>9367.68</td>
<td>16.7344</td>
<td>0.0</td>
<td>0.022216</td>
<td>52</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">198</th>
<td>8144.21</td>
<td>8233.26</td>
<td>8056.15</td>
<td>7729.10</td>
<td>7491.60</td>
<td>7380.43</td>
<td>7282.35</td>
<td>7076.46</td>
<td>6901.83</td>
<td>6794.68</td>
<td>...</td>
<td>8967.69</td>
<td>9041.05</td>
<td>8962.62</td>
<td>8754.40</td>
<td>8638.11</td>
<td>8801.52</td>
<td>16.7344</td>
<td>0.0</td>
<td>0.022216</td>
<td>52</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">199</th>
<td>8084.45</td>
<td>8189.22</td>
<td>8040.56</td>
<td>7728.67</td>
<td>7486.21</td>
<td>7363.75</td>
<td>7264.74</td>
<td>7068.97</td>
<td>6883.15</td>
<td>6744.28</td>
<td>...</td>
<td>8949.49</td>
<td>9057.16</td>
<td>8963.22</td>
<td>8726.82</td>
<td>8633.93</td>
<td>8811.21</td>
<td>16.7344</td>
<td>0.0</td>
<td>0.022216</td>
<td>52</td>
</tr>
</tbody>
</table>

<p>270 rows × 1655 columns</p>
</div>
</div>
</div></div>
<div id="45addcd6" class="cell markdown">
<section id="comparing-preprocessing-pipelines-standard-vs.-background-subtraction" class="level2">
<h2 class="anchored" data-anchor-id="comparing-preprocessing-pipelines-standard-vs.-background-subtraction">Comparing Preprocessing Pipelines: Standard vs.&nbsp;Background Subtraction</h2>
<p>This section visualizes the effects of different preprocessing pipelines on Raman spectra from various concentrations. We compare two preprocessing approaches:</p>
<ol type="1">
<li><strong>Standard Pipeline</strong>: Applies cropping, cosmic ray removal, denoising, and baseline correction</li>
<li><strong>Background Subtraction Pipeline</strong>: Crops the spectrum and subtracts a reference background spectrum</li>
</ol>
<p><strong>Key Objectives:</strong></p>
<ul>
<li>Understand how different preprocessing methods affect spectral appearance</li>
<li>Compare pipeline performance on spectra from different concentrations</li>
<li>Assess pipeline behavior on replicate spectra from the same concentration</li>
</ul>
<p><strong>Expected Observations:</strong></p>
<ul>
<li><p><strong>Background Subtraction Pipeline</strong>: When applied to spectra from different concentrations, this pipeline produces distinct spectral profiles that clearly differentiate between concentration levels. This demonstrates that the method effectively preserves concentration-dependent signal differences.</p></li>
<li><p><strong>Standard Pipeline</strong>: In contrast, the standard pipeline tends to produce more similar-looking spectra across different concentrations, as it focuses on removing artifacts and noise while preserving the overall spectral shape. This can be beneficial for certain types of analysis but may reduce concentration-dependent signal differences.</p></li>
</ul>
<p><strong>Important Note:</strong> The background subtraction pipeline uses the first spectrum in the dataset as the reference background. For spectra from the same sample (same concentration), this is the first replicate. For spectra from different samples (different concentrations), this corresponds to the first sample in the dataset, which is the zero concentration sample.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div id="335b762f7bdc6814" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;ExecuteTime&quot;,&quot;value&quot;:{&quot;end_time&quot;:&quot;2025-06-30T09:12:40.341695Z&quot;,&quot;start_time&quot;:&quot;2025-06-30T09:12:40.337547Z&quot;}}" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Required for exporting static images in Quarto documents.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (Comment out these lines to enable interactive Plotly plots in Jupyter or other interactive environments.)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>pio.renderers.default <span class="op">=</span> <span class="st">'png'</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_spectra_interactive(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    pipeline_type: Literal[<span class="st">"standard"</span>, <span class="st">"background"</span>] <span class="op">=</span> <span class="st">"standard"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    samples_type: Literal[<span class="st">"same"</span>, <span class="st">"different"</span>] <span class="op">=</span> <span class="st">"same"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    height: <span class="bu">int</span> <span class="op">=</span> <span class="dv">800</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    metadata_cols, spectral_cols, wavenumbers <span class="op">=</span> find_spectral_columns(df)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    spectral_container <span class="op">=</span> rp.SpectralContainer(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        spectral_data<span class="op">=</span>df[spectral_cols].values,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        spectral_axis<span class="op">=</span>wavenumbers,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    fig_title <span class="op">=</span> <span class="ss">f"Plot of </span><span class="sc">{</span>pipeline_type<span class="sc">}</span><span class="ss"> pipeline with </span><span class="sc">{</span>samples_type<span class="sc">}</span><span class="ss"> samples"</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">match</span> pipeline_type:</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">"standard"</span>:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            spectra_list <span class="op">=</span> standard_pipeline_without_normalisation.<span class="bu">apply</span>(spectral_container)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">"background"</span>:</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            spectra_list <span class="op">=</span> build_background_subtraction_pipeline(background<span class="op">=</span>spectral_container[<span class="dv">0</span>]).<span class="bu">apply</span>(spectral_container)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Series labels</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">match</span> samples_type:</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">"same"</span>:</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            series_labels <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(df)))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">"different"</span>:</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            series_labels <span class="op">=</span> df[[<span class="st">"glucose"</span>, <span class="st">"Na_acetate"</span>, <span class="st">"Mg_SO4"</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"glucose </span><span class="sc">{</span>x[<span class="st">'glucose'</span>]<span class="sc">:.2f}</span><span class="ss"> gL - Na_acetate </span><span class="sc">{</span>x[<span class="st">'Na_acetate'</span>]<span class="sc">:.2f}</span><span class="ss"> gL - Mg_SO4 </span><span class="sc">{</span>x[<span class="st">'Mg_SO4'</span>]<span class="sc">:.2f}</span><span class="ss"> gL"</span>, axis<span class="op">=</span><span class="dv">1</span>).tolist()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    all_spectra_dfs <span class="op">=</span> []</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, spectrum <span class="kw">in</span> <span class="bu">enumerate</span>(spectra_list):</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Wavenumber'</span>: spectrum.spectral_axis,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Intensity'</span>: spectrum.spectral_data</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        temp_df[<span class="st">'Series'</span>] <span class="op">=</span> series_labels[i]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        all_spectra_dfs.append(temp_df)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine all the small DataFrames into one large, tidy DataFrame</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> pd.concat(all_spectra_dfs, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the interactive plot</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.line(</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        plot_df,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'Wavenumber'</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'Intensity'</span>,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'Series'</span>,          <span class="co"># Each series gets a different color line</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>fig_title,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>{                 <span class="co"># Custom labels for axes</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Wavenumber"</span>: <span class="st">"Wavenumber (cm⁻¹)"</span>,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Intensity"</span>: <span class="st">"Intensity (a.u.)"</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        template<span class="op">=</span><span class="st">'plotly_white'</span>,  <span class="co"># A clean template with grids</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height,</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update subplot titles to be cleaner (optional)</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.for_each_annotation(lambda a: a.update(text=a.text.split("=")[1]))</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the figure in the Jupyter Notebook</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div id="7fd05e59" class="cell markdown">
<section id="comparing-pipelines-on-different-concentrations" class="level3">
<h3 class="anchored" data-anchor-id="comparing-pipelines-on-different-concentrations">Comparing Pipelines on Different Concentrations</h3>
<p>We first examine how each preprocessing pipeline handles spectra from <strong>different concentration levels</strong>. This helps us understand:</p>
<ul>
<li>How well each pipeline preserves concentration-dependent spectral features</li>
<li>The ability to distinguish between different analyte concentrations</li>
<li>The impact of preprocessing on quantitative signal information</li>
</ul>
<p>We select one representative spectrum from each unique concentration triplet to compare the pipelines on distinct samples.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div id="51e41d94" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>different_samples_df <span class="op">=</span> (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    df.groupby(<span class="st">"sample_number"</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .nth(<span class="dv">0</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>different_samples_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">200.0</th>
<th data-quarto-table-cell-role="th">202.0</th>
<th data-quarto-table-cell-role="th">204.0</th>
<th data-quarto-table-cell-role="th">206.0</th>
<th data-quarto-table-cell-role="th">208.0</th>
<th data-quarto-table-cell-role="th">210.0</th>
<th data-quarto-table-cell-role="th">212.0</th>
<th data-quarto-table-cell-role="th">214.0</th>
<th data-quarto-table-cell-role="th">216.0</th>
<th data-quarto-table-cell-role="th">218.0</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">3490.0</th>
<th data-quarto-table-cell-role="th">3492.0</th>
<th data-quarto-table-cell-role="th">3494.0</th>
<th data-quarto-table-cell-role="th">3496.0</th>
<th data-quarto-table-cell-role="th">3498.0</th>
<th data-quarto-table-cell-role="th">3500.0</th>
<th data-quarto-table-cell-role="th">glucose</th>
<th data-quarto-table-cell-role="th">Na_acetate</th>
<th data-quarto-table-cell-role="th">Mg_SO4</th>
<th data-quarto-table-cell-role="th">sample_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>7872.51</td>
<td>7949.13</td>
<td>7756.47</td>
<td>7430.07</td>
<td>7191.07</td>
<td>7054.33</td>
<td>6923.01</td>
<td>6728.96</td>
<td>6566.42</td>
<td>6446.71</td>
<td>...</td>
<td>8358.85</td>
<td>8459.03</td>
<td>8365.43</td>
<td>8120.00</td>
<td>7994.58</td>
<td>8164.45</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>7867.47</td>
<td>7945.25</td>
<td>7751.45</td>
<td>7424.17</td>
<td>7188.73</td>
<td>7061.26</td>
<td>6942.80</td>
<td>6761.27</td>
<td>6611.74</td>
<td>6500.41</td>
<td>...</td>
<td>8623.98</td>
<td>8714.13</td>
<td>8628.46</td>
<td>8391.91</td>
<td>8265.12</td>
<td>8434.56</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.022899</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">207</th>
<td>7342.39</td>
<td>7399.16</td>
<td>7207.68</td>
<td>6881.40</td>
<td>6641.70</td>
<td>6524.32</td>
<td>6434.70</td>
<td>6271.56</td>
<td>6124.36</td>
<td>6011.24</td>
<td>...</td>
<td>7215.12</td>
<td>7326.84</td>
<td>7226.49</td>
<td>6984.68</td>
<td>6873.00</td>
<td>7048.59</td>
<td>0.0</td>
<td>0.00000</td>
<td>1.483750</td>
<td>2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">84</th>
<td>7405.46</td>
<td>7469.17</td>
<td>7290.53</td>
<td>6987.57</td>
<td>6773.68</td>
<td>6670.61</td>
<td>6572.76</td>
<td>6380.83</td>
<td>6213.01</td>
<td>6102.20</td>
<td>...</td>
<td>7914.66</td>
<td>8002.84</td>
<td>7926.06</td>
<td>7731.41</td>
<td>7653.32</td>
<td>7804.36</td>
<td>0.0</td>
<td>0.00000</td>
<td>3.490220</td>
<td>3</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">190</th>
<td>7344.06</td>
<td>7410.08</td>
<td>7226.07</td>
<td>6909.59</td>
<td>6673.01</td>
<td>6540.97</td>
<td>6424.29</td>
<td>6245.51</td>
<td>6085.45</td>
<td>5962.36</td>
<td>...</td>
<td>6989.71</td>
<td>7082.35</td>
<td>6989.41</td>
<td>6777.86</td>
<td>6697.66</td>
<td>6873.22</td>
<td>0.0</td>
<td>0.01612</td>
<td>0.005016</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>5 rows × 1655 columns</p>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div id="53cc4c5f" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plot_spectra_interactive(df<span class="op">=</span>different_samples_df, pipeline_type<span class="op">=</span><span class="st">"standard"</span>, samples_type<span class="op">=</span><span class="st">"different"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="_eda_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [29]:</pre></div><div id="4f9109e4" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_spectra_interactive(df<span class="op">=</span>different_samples_df, pipeline_type<span class="op">=</span><span class="st">"background"</span>, samples_type<span class="op">=</span><span class="st">"different"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="_eda_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="6eb408ce" class="cell markdown">
<section id="comparing-pipelines-on-replicate-spectra" class="level3">
<h3 class="anchored" data-anchor-id="comparing-pipelines-on-replicate-spectra">Comparing Pipelines on Replicate Spectra</h3>
<p>Next, we examine how each preprocessing pipeline handles <strong>replicate spectra from the same concentration</strong>. This analysis reveals:</p>
<ul>
<li><strong>Measurement reproducibility</strong>: How consistent are replicate measurements after preprocessing?</li>
<li><strong>Noise characteristics</strong>: What residual variability remains after preprocessing?</li>
<li><strong>Pipeline stability</strong>: How do different preprocessing methods affect replicate consistency?</li>
</ul>
<p>We randomly select one sample (concentration triplet) and visualize all its replicate spectra to assess within-sample variability.</p>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [30]:</pre></div><div id="2ed615be" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw a random sample number</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>unique_sample_numbers <span class="op">=</span> df[<span class="st">"sample_number"</span>].unique()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>random_sample_number <span class="op">=</span> np.random.choice(unique_sample_numbers)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>same_samples_df <span class="op">=</span> df[df[<span class="st">"sample_number"</span>] <span class="op">==</span> random_sample_number]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>same_samples_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">200.0</th>
<th data-quarto-table-cell-role="th">202.0</th>
<th data-quarto-table-cell-role="th">204.0</th>
<th data-quarto-table-cell-role="th">206.0</th>
<th data-quarto-table-cell-role="th">208.0</th>
<th data-quarto-table-cell-role="th">210.0</th>
<th data-quarto-table-cell-role="th">212.0</th>
<th data-quarto-table-cell-role="th">214.0</th>
<th data-quarto-table-cell-role="th">216.0</th>
<th data-quarto-table-cell-role="th">218.0</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">3490.0</th>
<th data-quarto-table-cell-role="th">3492.0</th>
<th data-quarto-table-cell-role="th">3494.0</th>
<th data-quarto-table-cell-role="th">3496.0</th>
<th data-quarto-table-cell-role="th">3498.0</th>
<th data-quarto-table-cell-role="th">3500.0</th>
<th data-quarto-table-cell-role="th">glucose</th>
<th data-quarto-table-cell-role="th">Na_acetate</th>
<th data-quarto-table-cell-role="th">Mg_SO4</th>
<th data-quarto-table-cell-role="th">sample_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">39</th>
<td>7320.48</td>
<td>7419.34</td>
<td>7262.94</td>
<td>6932.90</td>
<td>6659.87</td>
<td>6511.08</td>
<td>6412.69</td>
<td>6254.91</td>
<td>6114.20</td>
<td>6003.54</td>
<td>...</td>
<td>6505.33</td>
<td>6628.53</td>
<td>6562.14</td>
<td>6346.97</td>
<td>6249.52</td>
<td>6424.52</td>
<td>0.26229</td>
<td>0.03709</td>
<td>1.4946</td>
<td>18</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>7406.77</td>
<td>7464.21</td>
<td>7264.81</td>
<td>6934.42</td>
<td>6697.93</td>
<td>6580.23</td>
<td>6468.39</td>
<td>6254.99</td>
<td>6088.88</td>
<td>6006.50</td>
<td>...</td>
<td>6514.41</td>
<td>6650.11</td>
<td>6582.10</td>
<td>6355.25</td>
<td>6250.23</td>
<td>6432.15</td>
<td>0.26229</td>
<td>0.03709</td>
<td>1.4946</td>
<td>18</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">35</th>
<td>7400.97</td>
<td>7517.01</td>
<td>7365.01</td>
<td>7025.82</td>
<td>6752.42</td>
<td>6622.32</td>
<td>6541.35</td>
<td>6361.16</td>
<td>6198.60</td>
<td>6089.23</td>
<td>...</td>
<td>6604.90</td>
<td>6699.57</td>
<td>6597.09</td>
<td>6374.15</td>
<td>6294.01</td>
<td>6489.00</td>
<td>0.26229</td>
<td>0.03709</td>
<td>1.4946</td>
<td>18</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">38</th>
<td>7331.09</td>
<td>7410.65</td>
<td>7238.04</td>
<td>6920.44</td>
<td>6677.50</td>
<td>6547.06</td>
<td>6443.18</td>
<td>6276.78</td>
<td>6130.41</td>
<td>6014.91</td>
<td>...</td>
<td>6526.00</td>
<td>6659.57</td>
<td>6572.41</td>
<td>6339.60</td>
<td>6255.41</td>
<td>6434.59</td>
<td>0.26229</td>
<td>0.03709</td>
<td>1.4946</td>
<td>18</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>7386.98</td>
<td>7465.57</td>
<td>7288.87</td>
<td>6969.29</td>
<td>6732.37</td>
<td>6613.17</td>
<td>6507.77</td>
<td>6306.82</td>
<td>6140.97</td>
<td>6039.23</td>
<td>...</td>
<td>6593.39</td>
<td>6661.59</td>
<td>6571.50</td>
<td>6375.59</td>
<td>6293.98</td>
<td>6460.65</td>
<td>0.26229</td>
<td>0.03709</td>
<td>1.4946</td>
<td>18</td>
</tr>
</tbody>
</table>

<p>5 rows × 1655 columns</p>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [31]:</pre></div><div id="33a2e62b" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_spectra_interactive(df<span class="op">=</span>same_samples_df, pipeline_type<span class="op">=</span><span class="st">"standard"</span>, samples_type<span class="op">=</span><span class="st">"same"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="_eda_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [32]:</pre></div><div id="85876fc4" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_spectra_interactive(df<span class="op">=</span>same_samples_df, pipeline_type<span class="op">=</span><span class="st">"background"</span>, samples_type<span class="op">=</span><span class="st">"same"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><img src="_eda_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div></div>
<div id="5dbf836b" class="cell markdown">
<section id="understanding-measurement-variability" class="level3">
<h3 class="anchored" data-anchor-id="understanding-measurement-variability">Understanding Measurement Variability</h3>
<p>The visualization above reveals important insights about measurement variability:</p>
<p><strong>Key Observations:</strong></p>
<ol type="1">
<li><strong>Intrinsic Experimental Variability</strong>: Even with identical sample concentrations, replicate spectra show some variation. This reflects:
<ul>
<li>Natural measurement noise inherent in Raman spectroscopy</li>
<li>Slight variations in sample positioning or laser focus</li>
<li>Instrument-specific measurement characteristics</li>
<li>Environmental factors (temperature, humidity, etc.)</li>
</ul></li>
<li><strong>Pipeline Impact on Variability</strong>:
<ul>
<li>The <strong>standard pipeline</strong> typically reduces variability by removing noise and artifacts, making replicates appear more similar</li>
<li>The <strong>background subtraction pipeline</strong> may preserve or even amplify certain types of variability, depending on the reference background used</li>
</ul></li>
<li><strong>Implications for Analysis</strong>:
<ul>
<li>Understanding this variability is crucial for setting appropriate model expectations</li>
<li>The residual variability after preprocessing represents the lower bound of prediction uncertainty</li>
<li>This information helps in designing robust models that can handle real-world measurement conditions</li>
</ul></li>
</ol>
<p>This variability analysis is essential for developing reliable quantitative models that can generalize to new measurements.</p>
</section>
</div>


     </main> <!-- /main -->  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nbrosse\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>  </div> <!-- /content --> 
  
</body></html>